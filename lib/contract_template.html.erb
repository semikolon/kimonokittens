<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hyresavtal - <%= tenant[:name] %></title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @font-face {
      font-family: 'Horsemen';
      src: url('file:///<%= fonts_dir %>/Horsemen.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Horsemen';
      src: url('file:///<%= fonts_dir %>/Horsemen%20(Slant).otf') format('opentype');
      font-weight: normal;
      font-style: italic;
    }

    @font-face {
      font-family: 'Galvji';
      src: url('file:///<%= fonts_dir %>/Galvji.ttc') format('truetype-collection');
      font-weight: normal;
      font-style: normal;
    }

    html {
      background: #ffffff !important;
      -webkit-print-color-adjust: exact !important;
      -webkit-filter: opacity(1) !important;
      print-color-adjust: exact !important;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Galvji', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #ffffff;  /* Clean white background - hides edge artifacts */
      color: #1a1a1a;  /* Dark gray for readability */
      font-size: 11pt;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      position: relative;
    }

    h1 {
      font-family: 'Horsemen', sans-serif;
      color: #512E6C;  /* Logo-derived medium purple (desaturated 50%) */
      font-weight: bold;
      line-height: 1.3;
    }

    h2, h3 {
      font-family: 'Galvji', sans-serif;
      color: #422D51;  /* Logo-derived dark purple (desaturated 50%) */
      font-weight: bold;
    }

    .widget-box {
      /* Ultra-subtle widget boxes with minimal contrast */
      background: #f9f8fa;  /* Almost white with subtle purple tint */
      border: 1.5px solid rgba(97, 76, 139, 0.18);  /* Logo purple, very faint (18% opacity) */
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(81, 46, 108, 0.08);  /* Logo-derived shadow, very subtle */
      page-break-inside: avoid;
    }

    .widget-box p {
      margin: 10px 0;  /* Space between paragraphs */
    }

    .widget-box p:first-child {
      margin-top: 0;
    }

    .widget-box p:last-child {
      margin-bottom: 0;
    }

    .widget-box strong {
      display: inline;  /* Keep bold inline, not block */
      font-weight: bold;
    }

    .widget-box ul {
      margin: 8px 0;
      padding-left: 20px;
    }

    .widget-box li {
      margin: 4px 0;
    }

    .widget-box hr {
      display: none;  /* Hide horizontal rules from markdown --- */
    }

    .section-title {
      font-family: 'Galvji', sans-serif;
      font-size: 0.8em;
      color: #614C8B;  /* Logo-derived lighter purple (desaturated 50%) */
      font-weight: bold;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.08em;  /* Wider spacing for uppercase readability */
      page-break-after: avoid;  /* Keep section headings with their content */
    }

    .logo {
      width: 250px;  /* Reduced from 288px to fit better with heading */
      float: right;
      margin-left: 20px;
      margin-right: 0;  /* Align close to right edge like dashboard */
    }

    .swish-qr {
      width: 120px;
      float: right;
      margin-left: 15px;
      margin-top: 0;
      margin-bottom: 10px;
      border-radius: 8px;
    }

    @page {
      margin: 50px 0 50px 0;  /* Top and bottom page margins */
      size: A4;
    }

    .container {
      max-width: 100%;
      margin: 0;
      padding: 0 60px 50px 60px;  /* Left, right, and bottom padding */
    }

    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Logo and Title -->
    <div style="margin-bottom: 40px; overflow: hidden;">
      <img src="file:///<%= logo_path %>" class="logo" alt="Kimonokittens">
      <h1 style="font-size: 25.2pt; margin: 0 0 1.2em 0; padding-top: 15px; padding-left: 15px;">
        HYRESAVTAL
      </h1>
      <p style="color: #64748b; font-size: 10pt; margin: 8px 0 0 0;">
        <%= tenant[:name] %> • <%= contract_period %>
      </p>
    </div>

    <div style="margin-top: 30px;">
      <p style="margin-bottom: 16px;">Mellan nedanstående parter har följande avtal slutits:</p>

      <!-- Section 1: Parter -->
      <h2 class="section-title">Parter</h2>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div class="widget-box" style="margin-bottom: 0;">
          <h3 style="font-size: 11pt; margin: 0 0 2px 0; text-transform: uppercase; color: #614C8B;">FÖRSTAHANDSHYRESGÄST</h3>
          <p style="font-size: 9pt; margin: 0 0 12px 0; color: #64748b;">Hyresvärd i detta avtal</p>
          <div style="margin-left: 15px; font-size: 10.5pt;">
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Namn:</strong> <span style="color: #475569;"><%= landlord[:name] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Personnummer:</strong> <span style="color: #475569;"><%= landlord[:personnummer] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Telefon:</strong> <span style="color: #475569;"><%= landlord[:phone] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">E-post:</strong> <span style="color: #475569;"><%= landlord[:email] %></span></p>
          </div>
        </div>

        <div class="widget-box" style="margin-bottom: 0;">
          <h3 style="font-size: 11pt; margin: 0 0 2px 0; text-transform: uppercase; color: #614C8B;">ANDRAHANDSHYRESGÄST</h3>
          <p style="font-size: 9pt; margin: 0 0 12px 0; color: #64748b;">Hyresgäst i detta avtal</p>
          <div style="margin-left: 15px; font-size: 10.5pt;">
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Namn:</strong> <span style="color: #475569;"><%= tenant[:name] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Personnummer:</strong> <span style="color: #475569;"><%= tenant[:personnummer] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">Telefon:</strong> <span style="color: #475569;"><%= tenant[:phone] %></span></p>
            <p style="margin: 3px 0;"><strong style="color: #1a1a1a;">E-post:</strong> <span style="color: #475569;"><%= tenant[:email] %></span></p>
          </div>
        </div>
      </div>

      <!-- Section 2: Objekt -->
      <h2 class="section-title">Objekt</h2>

      <div class="widget-box">
        <p style="margin: 0 0 6px 0;"><strong>Adress:</strong> <%= property[:address] %></p>
        <p style="margin: 6px 0 0 0;"><strong>Bostadstyp:</strong> <%= property[:type] %></p>
      </div>

      <!-- Section 3: Hyrestid -->
      <h2 class="section-title">Hyrestid</h2>

      <div class="widget-box">
        <%= rental_period_text %>
      </div>

      <!-- Section 4: Hyra -->
      <h2 class="section-title">Hyra</h2>

      <div class="widget-box" style="overflow: hidden;">
        <img src="file:///<%= swish_qr_path %>" class="swish-qr" alt="Swish QR Code">
        <p style="margin: 0 0 8px 0;"><strong>Kall månadshyra:</strong> <%= rent[:amount] %> kr.</p>
        <p style="margin: 8px 0;"><strong>Hyran måste ha inkommit på Hyresvärdens konto senast den <%= rent[:due_day] %> varje månad.</strong></p>
        <p style="margin: 8px 0 0 0;"><strong>Betalas till Swish:</strong> <%= rent[:swish] %>.</p>
      </div>

      <!-- Section 5: Avgifter för el och drift -->
      <h2 class="section-title">Avgifter för el och drift</h2>

      <div class="widget-box">
        <%= utilities_text %>
      </div>

      <!-- Section 6: Deposition -->
      <h2 class="section-title">Deposition</h2>

      <div class="widget-box">
        <%= deposit_text %>
      </div>

      <!-- Section 7: Inredningsdeposition -->
      <h2 class="section-title">Inredningsdeposition</h2>

      <div class="widget-box">
        <%= furnishing_deposit_text %>
      </div>

      <!-- Section 8: Uppsägning -->
      <h2 class="section-title">Uppsägning</h2>

      <div class="widget-box">
        <%= notice_period_text %>
      </div>

      <!-- Section 9: Övriga villkor -->
      <h2 class="section-title">Övriga villkor</h2>

      <div class="widget-box">
        <% other_terms.each do |term| %>
          <p style="margin: 6px 0;"><%= term %></p>
        <% end %>
      </div>

      <!-- Section 10: Hyresstruktur och demokratisk beslutsgång -->
      <h2 class="section-title">Hyresstruktur och demokratisk beslutsgång</h2>

      <div class="widget-box">
        <%= democratic_structure_text %>
      </div>

      <!-- Digital signatures via Zigned BankID (manual signature areas removed) -->
      <div style="margin-top: 40px;">
        <p style="margin-bottom: 20px; color: rgb(148, 163, 184); font-size: 10pt; font-style: italic;">
          Detta avtal signeras digitalt med BankID via Zigned e-signeringstjänst.
        </p>
      </div>

    </div>
  </div>
</body>
</html>
