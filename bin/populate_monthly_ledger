#!/usr/bin/env ruby
# frozen_string_literal: true

require 'dotenv/load'
require_relative '../lib/models/rent_ledger'

# Parse command line arguments (config month, not rent month)
year = ARGV[0]&.to_i || Time.now.year
month = ARGV[1]&.to_i || Time.now.month

puts "ğŸ  Populating rent ledger..."
puts "   Config period: #{year}-#{month.to_s.rjust(2, '0')}"
puts "   Rent month: #{RentLedger.swedish_rent_month(Time.utc(year, month, 1))}\n\n"

# Use RentLedger class method (DRY - no duplication!)
result = RentLedger.populate_for_month(year: year, month: month)

puts "\nâœ… Ledger populated via RentCalculator!"
puts "\nğŸ“‹ Final amounts:"
result['Rent per Roommate'].each do |name, amount|
  puts "  #{name.ljust(30)} | #{amount} kr"
end

total = result['Rent per Roommate'].values.sum
puts "\nğŸ’° Total: #{total} kr"
puts "âœ¨ Ledger population complete!"
