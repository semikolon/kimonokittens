generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CoOwnedItem {
  id           String   @id @default(cuid())
  name         String
  description  String?
  purchaseDate DateTime
  value        Float
  owners       Tenant[] @relation("ItemOwners")
}

model ElectricityBill {
  id         String   @id @default(cuid())
  provider   String
  billDate   DateTime
  amount     Float
  billPeriod DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([billDate(sort: Desc)])
  @@index([provider, billPeriod(sort: Desc)])
}

model RentConfig {
  id            String   @id @default(cuid())
  key           String
  value         String
  period        DateTime @default(now())
  isProjection  Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([key, period])
  @@index([key, period(sort: Desc)])
}

model RentLedger {
  id               String    @id
  tenantId         String
  period           DateTime
  amountDue        Float
  amountPaid       Float
  paymentDate      DateTime?
  createdAt        DateTime  @default(now())
  daysStayed       Float?
  roomAdjustment   Float?
  baseMonthlyRent  Float?
  calculationTitle String?
  calculationDate  DateTime?
  Tenant           Tenant    @relation(fields: [tenantId], references: [id])
}

model Tenant {
  id                 String           @id
  facebookId         String?          @unique
  name               String
  email              String           @unique
  avatarUrl          String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  roomAdjustment     Float?
  departureDate      DateTime?
  startDate          DateTime?
  // Contract fields
  personnummer       String?
  phone              String?
  baseRent           Decimal?         @db.Decimal(10, 2)
  deposit            Decimal?         @db.Decimal(10, 2)
  furnishingDeposit  Decimal?         @db.Decimal(10, 2)
  status             String?          @default("active")
  RentLedger         RentLedger[]
  CoOwnedItem        CoOwnedItem[]    @relation("ItemOwners")
  SignedContract     SignedContract[]
}

model SignedContract {
  id                  String    @id
  tenantId            String
  caseId              String    @unique
  pdfUrl              String
  status              String    @default("pending")
  landlordSigned      Boolean   @default(false)
  tenantSigned        Boolean   @default(false)
  landlordSignedAt    DateTime?
  tenantSignedAt      DateTime?
  landlordSigningUrl  String?
  tenantSigningUrl    String?
  testMode            Boolean   @default(false)
  completedAt         DateTime?
  expiresAt           DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([status])
}
